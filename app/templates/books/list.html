{% extends 'layout.html' %}
{% block title_suffix %} â€” Books{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <h1 class="h3 m-0">Books</h1>
  <form class="d-flex" method="get" id="search-form">
    <input class="form-control form-control-sm me-2" type="search" placeholder="Search" name="q" value="{{ q }}">
    <input type="hidden" name="sort" value="{{ sort_by }}">
    <input type="hidden" name="order" value="{{ sort_order }}">
    <button class="btn btn-sm btn-primary" type="submit">Search</button>
  </form>

</div>

<div class="mb-3 text-muted">
  <small>
    {{ total_books }} book{{ '' if total_books == 1 else 's' }},
    {{ total_highlights }} highlight{{ '' if total_highlights == 1 else 's' }}
  </small>
  </div>

<table class="table table-sm align-middle">
  <thead>
    <tr>
      <th style="width:64px">Cover</th>
      <th>
        <a href="?q={{ q }}&sort=title&order={{ 'desc' if sort_by == 'title' and sort_order == 'asc' else 'asc' }}" class="text-decoration-none text-dark">
          Title
          {% if sort_by == 'title' %}
            <i class="fa-solid fa-sort-{{ 'down' if sort_order == 'desc' else 'up' }} ms-1"></i>
          {% else %}
            <i class="fa-solid fa-sort ms-1 text-muted"></i>
          {% endif %}
        </a>
      </th>
      <th>
        <a href="?q={{ q }}&sort=author&order={{ 'desc' if sort_by == 'author' and sort_order == 'asc' else 'asc' }}" class="text-decoration-none text-dark">
          Authors
          {% if sort_by == 'author' %}
            <i class="fa-solid fa-sort-{{ 'down' if sort_order == 'desc' else 'up' }} ms-1"></i>
          {% else %}
            <i class="fa-solid fa-sort ms-1 text-muted"></i>
          {% endif %}
        </a>
      </th>
      <th class="text-center" style="width:100px">
        <a href="?q={{ q }}&sort=highlights&order={{ 'desc' if sort_by == 'highlights' and sort_order == 'asc' else 'asc' }}" class="text-decoration-none text-dark">
          Highlights
          {% if sort_by == 'highlights' %}
            <i class="fa-solid fa-sort-{{ 'down' if sort_order == 'desc' else 'up' }} ms-1"></i>
          {% else %}
            <i class="fa-solid fa-sort ms-1 text-muted"></i>
          {% endif %}
        </a>
      </th>
      <th>Open Library</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for b in books %}
    <tr>
      <td>
        {% if b.image_data %}
          <img src="{{ url_for('books.cover_image', book_id=b.id) }}" alt="cover" style="height:48px; width:auto; border-radius:4px;">
        {% endif %}
      </td>
      <td>
        <a href="{{ url_for('books.book_detail', book_id=b.id) }}">{{ b.clean_title or b.raw_title or '(untitled)' }}</a>
      </td>
      <td>{{ b.clean_authors or b.raw_authors }}</td>
      <td class="text-center"><span class="badge type-badge">{{ counts.get(b.id, 0) }}</span></td>
      <td>{% if b.goodreads_url %}<a href="{{ b.goodreads_url }}" target="_blank">Link</a>{% endif %}</td>
      <td class="text-end"><a class="btn btn-sm btn-outline-secondary" href="{{ url_for('books.book_edit', book_id=b.id) }}">Edit</a></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
